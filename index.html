<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
  
    <script>

		
      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
        
        var index = 0;
        
        $("<h1>twittler <span id='news-feed'>news feed</span></h1>").prependTo($body);
        
        $("<button class='new-tweet'>New Tweets</button>").appendTo($body);
        
        $("<div class='stream'></div>").appendTo($body);
        
        $("<h2>News Feed</h2>").prependTo(".stream");
        
        
        function formattedTime(time) {
        	var timeArray = time.toString().split(" ");
        	var date = timeArray.slice(0,4).join(" ");
        	var formatted = timeArray[4].split(":").slice(0,2);
        	var morningAfternoon = formatted[0] >= 12 ? "pm" : "am";        		
        	if(formatted[0] > 12) {formatted[0] -=12};
        	return "On " + date + " at " + formatted.join(":") + morningAfternoon;		
        };
        
        function userTimelineFilter(a,b,c) {
        	$(a).toggleClass("filter");
        	$(b).toggleClass("filter");
        	$(c).toggleClass("filter");
        };
        
        function applyTimelines() {
        	$(".userName-mracus").on("click", function() {
        		userTimelineFilter(".shawndrost", ".sharksforcheap", ".douglascalhoun");
        	});
        	$(".userName-shawndrost").on("click", function() {
        		userTimelineFilter(".mracus", ".sharksforcheap", ".douglascalhoun");
        	});
        	$(".userName-sharksforcheap").on("click", function() {
        		userTimelineFilter(".mracus", ".shawndrost", ".douglascalhoun");
        	});
        	$(".userName-douglascalhoun").on("click", function() {
        		userTimelineFilter(".mracus", ".shawndrost", ".sharksforcheap");
        	});
        };
        	
        function loadTweets() {
        	while(index < streams.home.length){
          		var tweet = streams.home[index];
          		var $tweet = $('<div class='+tweet.user+'></div>');
          		var formatted = formattedTime(tweet.created_at);
          		$tweet.text(': ' + tweet.message);
          		$('<p class="timestamp">'+formatted+'</p>').appendTo($tweet);
          		$('<span class="link userName-'+tweet.user+'">@'+tweet.user+'</span>').prependTo($tweet);
          		($tweet).addClass("tweet");
          		$tweet.insertAfter("h2");
          		index += 1;
        	} 
        };
        
        loadTweets();
        applyTimelines();
        
        $(".new-tweet").on("click", function() {
        	loadTweets();
        	applyTimelines();
        });
      });

    </script>
  </body>
</html>
